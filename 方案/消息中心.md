# 消息中心
> 凤凰秀消息中心分为聊天(message),消息(notification),推送(push)等几个部分 \
> 聊天,消息,推送都有单独的数据表.部分特殊消息会进行推送,通过消息队列进行削封减少压力,保证消息被后端发送.

消息调度中心
其他服务怎么调用,怎么处理/保存,怎么分发.整体流程

## message
> 分为直播聊天,私信.详细设计见 messageService

系统消息存储
超90天优化处理
关注 / 系统通知 / 公告 / 交互推送 要分开


### message场景
- 订阅号和用户
- 用户和用户
- 直播间互动

## 系统消息
- 

## notification
- 消息类型
  - 点赞
  - 评论回复
  - 关注
  - 系统消息(关注的订阅号发布动态)
- 数据结构
  ```js
  {
    _id: string,
    owner_id: string,
    user_id: string,
    type: string, // praise,comment,reply,subscribe,
    resource_id: string,
    resource_type: string,
    is_read: number, // 是否已读. 0 未读, 1 已读
    is_delete: number, // 是否删除. 0 未删除, 1 已删除
    createdAt: date,
    modifiedAt: date,
    // target: 回复评论和点赞收藏,属于媒体资源类型的应该有target信息
    content: string,
  }
  ```
- 接口
  - 消息列表(按页码,类型,排序,未读)
  - 消息已读
  - 删除消息
  - 全部已读
  - 获取消息计数
  - 搜索?

## push
- 送达渠道
  - 短信
  - 邮箱
  - 应用通知栏
  - 应用内
- 消息类型
  - 通过通知栏打开app页面
  - 退出登录
  - 消息计数更新
  - 重大新闻alert提醒
  - 其他
- 消息结构
  ```js
  {
    _id: string, // 唯一id
    type: string,// 消息类型.点赞,评论,回复,退出登录,更新计数
    audience: object, // 推送目标
    sender: {
      type: string, // user,system,subscription
       _id: string,
       name: string
    }, // 发送者

    title: string,
    content: string,  // 内容
    m_type: string,
    createdAt: date,
    modifiedAt: date,
    resource_id: string,
    resource_type: string,

    platform: [string], // 推送的平台,
    options: object, // 额外参数
    method: string, //推送方式.短信,邮箱,jiguang,...
    status: number
  }
  ```

  ## 参考
  - [站内消息系统](https://qsjzwithguang19forever.gitee.io/framework-learning/gitbook_doc/system_architecture_design/%E7%AB%99%E5%86%85%E6%B6%88%E6%81%AF%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AE%BE%E8%AE%A1.html)
  - [凤凰消息机制](http://octopus.phoenixtv.com/fengshows/repository/-/wikis/message)